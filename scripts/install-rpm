#!/bin/bash
# Installs locally built RPM in dom0.
# Required for local builds.
set -e
set -u
set -o pipefail


fedora_version="$(rpm --eval %{fedora})"

if [[ $fedora_version = "25" ]]; then
    echo "Installing RPM for Qubes 4.0, Fedora ${fedora_version}..."
elif [[ $fedora_version = "32" ]]; then
    echo "Installing RPM for Qubes 4.1, Fedora ${fedora_version}..."
else
    echo "ERROR: Unsupported Fedora version '${fedora_version}'"
    exit 1
fi

find rpm-build/ -type f -iname "*fc${fedora_version}.noarch.rpm" -print0 \
    | sort -zV | tail -zn1 \
    | xargs -0 sudo dnf install -y
